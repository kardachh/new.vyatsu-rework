<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет</title>
    <link href="/../output.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.js"
            integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
</head>

<!-- body page -->
<div id="body" class="absolute text-justify top-48 sm:top-36 sm:left-72 p-4 sm:p-10">
    <!--  опросы  -->
    <div>
        <!--  опрос активный  -->
        <div class="min-h-[60px] bg-[#2E9ECB]/[0.15] flex mb-4 last:mb-0 rounded-xl ">
            <div class="hidden lg:block w-[8px] min-h-[60px] bg-[#2E9ECB] rounded-tl-xl rounded-bl-xl"></div>
            <div class="w-full flex flex-col lg:flex-row justify-between lg:items-center p-5 lg:p-0 lg:pl-4">
                <!-- наименование опроса -->
                <div class="text-xl lg:text-base lg:w-2/3">123</div>
                <!-- кнопки -->
                <div>
                    <div class="text-white text-xl lg:text-base bg-[#2E9ECB] mt-4 lg:mt-0 min-h-[60px] p-4 md:min-w-[170px] rounded-xl flex justify-center items-center drop-shadow-lg md:drop-shadow-none cursor-pointer mr-6 last:mr-0">
                        <div>Пройти</div>
                    </div>
                </div>
            </div>
        </div>
        <!--  опрос неактивный  -->
        <div class="min-h-[60px] bg-[#E7E7E7]/[0.15] flex mb-4 last:mb-0 rounded-xl ">
            <div class="hidden lg:block w-[8px] min-h-[60px] bg-[#E7E7E7] rounded-tl-xl rounded-bl-xl"></div>
            <div class="w-full flex flex-col lg:flex-row justify-between lg:items-center p-5 lg:p-0 lg:pl-4">
                <!-- наименование опроса -->
                <div class="text-xl lg:text-base lg:w-2/3">
                    Очень интересное описание опроса,<br> которое желательно <br> займет много места
                </div>
                <!-- кнопки -->
                <div class = "flex flex-row justify-evenly h-full">
                    <div class="text-black text-xl lg:text-base bg-[#E7E7E7] mt-4 lg:mt-0 min-h-[60px] p-4 only:w-full md:min-w-[170px] rounded-xl flex justify-center items-center drop-shadow-lg lg:drop-shadow-none cursor-pointer mr-6 last:mr-0">
                        <div>Пройти</div>
                    </div>
                </div>
            </div>
        </div>
        <!--  опрос неактивный + результаты -->
        <div class="min-h-[60px] bg-[#E7E7E7]/[0.15] flex mb-4 last:mb-0 rounded-xl ">
            <div class="hidden lg:block w-[8px] min-h-[60px] bg-[#E7E7E7] rounded-tl-xl rounded-bl-xl"></div>
            <div class="w-full flex flex-col lg:flex-row justify-between lg:items-center p-5 lg:p-0 lg:pl-4">
                <!-- наименование опроса -->
                <div class="text-xl lg:text-base lg:w-2/3">
                    Очень интересное описание опроса,<br> которое желательно <br> займет много места
                </div>
                <!-- кнопки -->
                <div class = "flex flex-row justify-evenly h-full">
                    <div class="text-black text-xl lg:text-base bg-[#E7E7E7] mt-4 lg:mt-0 min-h-[60px] w-2/4 only:w-full md:min-w-[170px] rounded-xl flex justify-center items-center drop-shadow-lg lg:drop-shadow-none cursor-pointer mr-6 last:mr-0">
                        <div>Пройти</div>
                    </div>

                    <div class="text-black text-xl lg:text-base bg-[#E7E7E7] mt-4 lg:mt-0 min-h-[60px] w-2/4 only:w-full md:min-w-[170px] rounded-xl flex justify-center items-center drop-shadow-lg lg:drop-shadow-none cursor-pointer mr-6 last:mr-0">
                        <div>Результаты</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- TODO: использован jquery, переписать на vue.js -->

<!-- для прокрутки часто открываемых страниц -->
<script>
    const leftArrow = $(".left-arrow")
    const rightArrow = $(".right-arrow")
    const scrollCont = $("#favorite-pages")

    let scrollPos = 0;


    const checkScroll = () => {
        const maxLeft = scrollCont[0].scrollWidth - scrollCont[0].clientWidth
        let st = $(scrollCont).scrollLeft();

        st < maxLeft ?
            $(rightArrow).css("display", "flex") :
            $(rightArrow).css("display", "none")
        st > 0 ?
            $(leftArrow).css("display", "flex") :
            $(leftArrow).css("display", "none")
        scrollPos = st;
    }

    $(document).ready(checkScroll)
    $(window).resize(checkScroll)
    $(scrollCont).scroll(checkScroll)

    $(leftArrow).on("click", () => $(scrollCont).animate({
        scrollLeft: scrollPos - 250
    }, 500, 'swing'))
    $(rightArrow).on("click", () => $(scrollCont).animate({
        scrollLeft: scrollPos + 250
    }, 500, 'swing'))
</script>

<!-- открытие left-menu в мобильной версии -->
<script>
    const burger = $(".burger");
    const leftMenu = $("#left-menu")
    const topBar = $("#top-bar")
    const close = $(".left-menu-close")

    const onClickBurger = () => {
        leftMenu.removeClass('hidden')
        leftMenu.addClass("block")

        topBar.addClass("hidden")
        $("body").css("overflow", "hidden")
    }

    const onClickClose = () => {
        leftMenu.addClass("hidden")

        topBar.removeClass('hidden')
        topBar.addClass("flex")
        $("body").css("overflow", "auto")
    }

    $(burger).click(() => onClickBurger())
    $(close).click(() => onClickClose())
</script>

<!-- динамическое заполнение и работа left-menu -->
<script>
    const numberMenu = $('#number-menu')
    const leftMenuName = $('.left-menu-name')
    const leftMenuItems = $('#left-menu-items')
    const leftMenuNumberTop = $('#left-menu-number-top')
    const leftMenuLeftArrow = $('#left-menu-left-arrow')
    const leftMenuRightArrow = $('#left-menu-right-arrow')

    let currentLeftMenu = 0;
    //! для отладки
    const leftMenuInfo = [
        {
            name: "Наш университет",
            links: [{
                name: "Сведения об ОО",
                url: "https://new.vyatsu.ru/sveden/"
            },],
        },
        {
            name: "Поступление",
            links: [{
                name: "Специальности и направления подготовки",
                url: "https://new.vyatsu.ru/admission/admission_special/"
            },
                {
                    name: "Подготовка к поступлению",
                    url: "https://new.vyatsu.ru/admission/prep_admission/"
                },
                {
                    name: "Информация о приёме",
                    url: "https://new.vyatsu.ru/admission/admission_info/"
                },
                {
                    name: "Календарь абитуриента",
                    url: "https://new.vyatsu.ru/admission/admission_terms/"
                },
                {
                    name: "Специальности и направления",
                    url: "https://new.vyatsu.ru/admission/admission_special/"
                },
                {
                    name: "Специальности и направления",
                    url: "https://new.vyatsu.ru/admission/admission_special/"
                },
            ],
        },
        {
            name: "Cотруднику",
            links: [{
                name: "Ссылка на страницу сотрудников",
                url: "https://www.vyatsu.ru/sotrudniku.html"
            },],
        },
    ];

    const changeLeftMenu = (number) => {
        if (number === leftMenuInfo.length) {
            currentLeftMenu = 0
        } else if (number < 0) {
            currentLeftMenu = leftMenuInfo.length - 1;
        } else currentLeftMenu = number

        leftMenuNumberTop.text(`${currentLeftMenu + 1}.`);
        leftMenuName.text(leftMenuInfo[currentLeftMenu].name)

        leftMenuItems.children().remove()
        leftMenuItems.append(leftMenuInfo[currentLeftMenu].links.map((link) => `
            <a href=${link.url} draggable=false class="w-full h-16 px-5 border-t first:border-t-0 border-white flex justify-start items-center text-white text-[14px] sm:text-base cursor-pointer ">
                ${link.name}
            </a>
        `))

        numberMenu.children().removeClass('font-bold text-lg')
        $(`#number-menu-${currentLeftMenu}`).addClass('font-bold text-lg')
    }

    //
    $(document).ready(() => {
        numberMenu.append(leftMenuInfo.map((leftMenusItem, index) => {
            return `
            <div id="number-menu-${index}" class="number-menu-item cursor-pointer mr-4 last:mr-0">
                ${index + 1}
            </div>
            `
        }))

        $(".number-menu-item").click((number) =>
            changeLeftMenu(parseInt($(number.target).attr('id').split('-')[2])))

        leftMenuLeftArrow.click(() => changeLeftMenu(--currentLeftMenu))
        leftMenuRightArrow.click(() => changeLeftMenu(++currentLeftMenu))

        changeLeftMenu(currentLeftMenu);
    });
</script>

<!-- заполнение часто посещаемых страниц -->
<script>
    //! для отладки
    const favoritePagesInfo = [
        {
            name: "Расписание",
            url: "#"
        },
        {
            name: "Зачетная книжка",
            url: "#"
        },
        {
            name: "Опросы",
            url: "#"
        },
        {
            name: "Календарь абитуриента",
            url: "#"
        },
        {
            name: "Специальности",
            url: "#"
        },
        {
            name: "День открытых дверей",
            url: "#"
        },
    ]
    $('#favorite-pages').append(favoritePagesInfo.map((page) => `
        <a draggable=false href="${page.url}" class="cursor-pointer mr-4 last:mr-0 text-sm sm:text-base border hover:bg-[#2E9ECB] hover:text-white py-1 px-4 rounded-xl flex justify-center items-center">
            <div>${page.name}</div>
        </a>
    `))
</script>

<!-- показ меню пользователя при наведении -->
<script>
    const userZone = document.getElementsByClassName('user-zone')[0];
    const userMenu = document.getElementsByClassName('user-menu')[0];

    const handler = (info) => (info.type === 'mouseover') ? userMenu.classList.remove('hidden') : userMenu.classList.add('hidden')

    userZone.onmouseover = userMenu.onmouseover = handler
    userZone.onmouseout = userMenu.onmouseout = handler
</script>
